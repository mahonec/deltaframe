var RequestAnimationFrame=function(){this.id=null;this.running=!1;this.fn=function(){};this.usingSetTimeout=!1;window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return setTimeout(a,1E3/60)};window.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||function(){clearTimeout(this.id)}};
RequestAnimationFrame.prototype.start=function(a,b){var c=this;this.running||(this.running=!0,this.fn=a,b?(this.usingSetTimeout=!0,this.updateTimeout()):window.requestAnimationFrame(function(a){return c.updateRAF(a)}))};RequestAnimationFrame.prototype.updateRAF=function(a){var b=this;this.running=!0;this.fn(a);this.id=window.requestAnimationFrame(function(a){return b.updateRAF(a)})};
RequestAnimationFrame.prototype.updateTimeout=function(){var a=this,b=window.performance.now();this.fn(b);this.id=window.setTimeout(function(){return a.updateTimeout()},1E3/60)};RequestAnimationFrame.prototype.restart=function(){var a=this;this.usingSetTimeout?window.clearTimeout(this.id):window.cancelAnimationFrame(this.id);this.id=null;this.running=!1;this.usingSetTimeout?this.updateTimeout():window.requestAnimationFrame(function(b){return a.updateRAF(b)});this.running=!0};
RequestAnimationFrame.prototype.stop=function(){this.usingSetTimeout?window.clearTimeout(this.id):window.cancelAnimationFrame(this.id);this.id=null;this.running=!1;this.fn=function(){}};
var Deltaframe=function(a){a=void 0===a?{}:a;this.options=Object.assign({minFps:15,targetFps:60,maxRestartAttempts:Infinity,forceSetTimeout:!1},a);this.forceSetTimeout=this.options.forceSetTimeout;this.minFps=this.options.minFps;this.targetFps=this.options.targetFps;this._minFps=Math.floor(1E3/this.minFps);this._targetFps=Math.floor(1E3/this.targetFps);this.maxRestartAttempts=this.options.maxRestartAttempts;this.restartAttempts=0;this.paused=this.running=!1;this.fn=function(){};this.delta=this.prevTime=
this.time=this.frame=0;this.deltaHistory=[];this.deltaIndex=0;this.raf=new RequestAnimationFrame;this.hidden=document.hidden||document.webkitHidden||document.mozHidden||document.msHidden||document.oHidden;this._boot()};Deltaframe.prototype._boot=function(){var a=this;document.onvisibilitychange=function(){var b=document.visibilityState;"visible"===b?a.resume():"hidden"===b&&a.pause()}};
Deltaframe.prototype.start=function(a){var b=this;this.fn=a;this.prevTime=0;this.raf.start(function(a){return b._update(a)},this.forceSetTimeout)};
Deltaframe.prototype._update=function(a){if(!this.paused){this.time=a;this.delta=a-this.prevTime;10===this.deltaIndex&&(this.deltaIndex=0);this.deltaHistory[this.deltaIndex]=this.delta;this.deltaIndex++;for(var b=0,c=0;c<this.deltaHistory.length;++c)b+=this.deltaHistory[c];this.deltaAverage=b/10;if(this.deltaAverage>=this._minFps){if(this.restartAttempts===this.maxRestartAttempts){this.stop();return}this.raf.restart();this.restartAttempts++}this.deltaAverage>=this._targetFps&&(this.frame++,this.fn(a,
this.delta,this.deltaAverage),this.prevTime=a)}};Deltaframe.prototype.pause=function(){this.paused=!0;this.running=!1};Deltaframe.prototype.resume=function(){this.paused=!1;this.prevTime=window.performance.now();this.running=!0};Deltaframe.prototype.stop=function(){this.restartAttempts=0;this.paused=this.running=!1;this.fn=function(){};this.delta=this.prevTime=this.time=this.frame=0;this.deltaHistory=[];this.deltaIndex=0;this.raf.stop()};